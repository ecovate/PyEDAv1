on:
  workflow_dispatch:
    inputs:
      logLevel:
        description: 'Log level'
        required: true
        default: 'warning'
        type: choice
        options:
          - info
          - warning
          - debug
      tags:
        description: 'Test scenario tags'
        required: false
        type: boolean
      environment:
        required: true
        default: 'infra-test'
        description: |
          üõë DO NOT CHANGE THE DROPDOWN ABOVE FOR THE WORKFLOW. KEEP IT ON "main" BRANCH.
          --------------------------------------
          ‚¨áÔ∏è Environment.
        type: choice
        options:
          - infra-test
          - dev
          - prod
      action:
        required: true
        default: 'start'
        description: |
          Start / Stop environment
        type: choice
        options:
          - start
          - stop
env:
  deployment_env: ${{github.event.inputs.environment || 'infra-test'}}
jobs:
  # Check env
  check-env:
    if: env.deployment_env == 'infra-test'
    runs-on: ubuntu-latest
    steps:
      - name: print environment
        run: |
          echo "Test environment"
  start-service:
    needs: check-env
    if: env.deployment_env == 'infra-test'
    runs-on: ubuntu-latest
    steps:
      - name: 'start-service'
        if: github.event.inputs.action == 'start-service'
        run: |
          echo "aws ecs start-task --task-definition massgov-pfml-${{ github.event.inputs.taskdefinition }} --cluster massgov-pfml-${{ github.event.inputs.cluster }}"
          echo "aws rds start-db-instance --db-instance-identifier massgov-pfml-${{ github.event.inputs.environment }}"
  stop-service:
    if: env.deployment_env == 'infra-test'
    runs-on: ubuntu-latest
    steps:
      - name: 'stop service'
        if: github.event.inputs.action == 'stop-service'
        run: |
          echo "aws ecs stop-task --task-definition massgov-pfml-${{ github.event.inputs.taskdefinition }} --cluster massgov-pfml-${{ github.event.inputs.cluster }}"
          echo "aws rds stop-db-instance --db-instance-identifier massgov-pfml-${{ github.event.inputs.environment }}"
